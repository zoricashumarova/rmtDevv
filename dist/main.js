(()=>{"use strict";const e="https://bytegrad.com/course-assets/js/2/api",t={searchJobItems:[],bookmarkedJobItems:[],activeJobItem:{},currentPage:1},o=document.querySelector(".bookmarks-btn"),s=document.querySelector(".error"),i=document.querySelector(".error__text"),n=document.querySelector(".job-details"),a=document.querySelector(".job-details__content"),c=document.querySelector(".job-list--bookmarks"),r=document.querySelector(".job-list--search"),l=document.querySelector(".count__number"),d=document.querySelector(".pagination"),b=document.querySelector(".pagination__button--next"),m=document.querySelector(".pagination__button--back"),_=document.querySelector(".pagination__number--next"),u=document.querySelector(".pagination__number--back"),v=document.querySelector(".search"),g=document.querySelector(".search__input"),f=document.querySelector(".sorting"),p=document.querySelector(".sorting__button--relevant"),h=document.querySelector(".sorting__button--recent"),j=document.querySelector(".spinner--search"),k=document.querySelector(".spinner--job-details"),y=async e=>{const t=await fetch(e),o=await t.json();if(!t.ok)throw new Error(o.description);return o},L=(e="Something went wrong")=>{i.textContent=e,s.classList.add("error--visible"),setTimeout((()=>{s.classList.remove("error--visible")}),3500)},$=e=>{const t=`\n        <img src="${e.coverImgURL}" alt="#" class="job-details__cover-img">\n\n        <a class="apply-btn" href="${e.companyURL}" target="_blank">Apply <i class="fa-solid fa-square-arrow-up-right apply-btn__icon"></i></a>\n\n        <section class="job-info">\n            <div class="job-info__left">\n                <div class="job-info__badge">${e.badgeLetters}</div>\n                <div class="job-info__below-badge">\n                    <time class="job-info__time">${e.daysAgo}d</time>\n                    <button class="job-info__bookmark-btn">\n                        <i class="fa-solid fa-bookmark job-info__bookmark-icon"></i>\n                    </button>\n                </div>\n            </div>\n            <div class="job-info__right">\n                <h2 class="second-heading">${e.title}</h2>\n                <p class="job-info__company">${e.company}</p>\n                <p class="job-info__description">${e.description}</p>\n                <div class="job-info__extras">\n                    <p class="job-info__extra"><i class="fa-solid fa-clock job-info__extra-icon"></i> ${e.duration}</p>\n                    <p class="job-info__extra"><i class="fa-solid fa-money-bill job-info__extra-icon"></i> ${e.salary}</p>\n                    <p class="job-info__extra"><i class="fa-solid fa-location-dot job-info__extra-icon"></i> ${e.location}</p>\n                </div>\n            </div>\n        </section>\n\n        <div class="job-details__other">\n            <section class="qualifications">\n                <div class="qualifications__left">\n                    <h4 class="fourth-heading">Qualifications</h4>\n                    <p class="qualifications__sub-text">Other qualifications may apply</p>\n                </div>\n                <ul class="qualifications__list">\n                    ${e.qualifications.map((e=>`<li class="qualifications__item">${e}</li>`)).join("")}\n                </ul>\n            </section>\n            \n            <section class="reviews">\n                <div class="reviews__left">\n                    <h4 class="fourth-heading">Company reviews</h4>\n                    <p class="reviews__sub-text">Recent things people are saying</p>\n                </div>\n                <ul class="reviews__list">\n                    ${e.reviews.map((e=>`<li class="reviews__item">${e}</li>`)).join("")}\n                </ul>\n            </section>\n        </div>\n\n        <footer class="job-details__footer">\n            <p class="job-details__footer-text">If possible, please reference that you found the job on <span class="u-bold">rmtDev</span>, we would really appreciate it!</p>\n        </footer>\n    `;a.innerHTML=t},q=e=>{("search"===e?j:k).classList.toggle("spinner--visible")};r.addEventListener("click",(async o=>{o.preventDefault();const s=o.target.closest(".job-item");document.querySelector(".job-item--active")?.classList.remove("job-item--active"),s.classList.add("job-item--active"),a.innerHTML="",q("job-details");const i=s.children[0].getAttribute("href");t.activeJobItem=t.searchJobItems.find((e=>e.id===+i)),console.log(t.activeJobItem),history.pushState(null,"",`/#${i}`);try{const t=await y(`${e}/jobs/${i}`),{jobItem:o}=t;q("job-details"),$(o)}catch(e){q("job-details"),L(e.message)}}));const I=(e="search")=>{const o="search"===e?r:c;let s=[];s="search"===e?t.searchJobItems.slice(7*t.currentPage-7,7*t.currentPage):t.bookmarkedJobItems,o.innerHTML="",s.forEach((e=>{const s=`\n            <li class="job-item ${t.activeJobItem.id===e.id?"job-item--active":""}">\n                <a class="job-item__link" href="${e.id}">\n                    <div class="job-item__badge">${e.badgeLetters}</div>\n                    <div class="job-item__middle">\n                        <h3 class="third-heading">${e.title}</h3>\n                        <p class="job-item__company">${e.company}</p>\n                        <div class="job-item__extras">\n                            <p class="job-item__extra"><i class="fa-solid fa-clock job-item__extra-icon"></i> ${e.duration}</p>\n                            <p class="job-item__extra"><i class="fa-solid fa-money-bill job-item__extra-icon"></i> ${e.salary}</p>\n                            <p class="job-item__extra"><i class="fa-solid fa-location-dot job-item__extra-icon"></i> ${e.location}</p>\n                        </div>\n                    </div>\n                    <div class="job-item__right">\n                        <i class="fa-solid fa-bookmark job-item__bookmark-icon ${t.bookmarkedJobItems.find((t=>t.id===e.id))?"job-item__bookmark-icon--bookmarked":""}"></i>\n                        <time class="job-item__time">${e.daysAgo}d</time>\n                    </div>\n                </a>\n            </li>\n        `;o.insertAdjacentHTML("beforeend",s)}))},w=()=>{t.currentPage>=2?m.classList.remove("pagination__button--hidden"):m.classList.add("pagination__button--hidden"),t.searchJobItems.length-7*t.currentPage<=0?b.classList.add("pagination__button--hidden"):b.classList.remove("pagination__button--hidden"),_.textContent=t.currentPage+1,u.textContent=t.currentPage-1,b.blur(),m.blur()};d.addEventListener("click",(e=>{const o=e.target.closest(".pagination__button");o&&(o.className.includes("--next")?t.currentPage++:t.currentPage--,w(),I())}));const S=w,x=async()=>{const o=window.location.hash.substring(1);if(o){a.innerHTML="",q("job-details");try{const s=await y(`${e}/jobs/${o}`),{jobItem:i}=s;t.activeJobItem=i,q("job-details"),$(i)}catch(e){q("job-details"),renderError(e.message)}}};window.addEventListener("DOMContentLoaded",x),window.addEventListener("hashchange",x),v.addEventListener("submit",(async o=>{o.preventDefault();const s=g.value;if(/[0-9]/.test(s))L("Your search may not contain numbers");else{g.blur(),r.innerHTML="",h.classList.remove("sorting__button--active"),p.classList.add("sorting__button--active"),q("search");try{const o=await y(`${e}/jobs?search=${s}`),{jobItems:i}=o;t.searchJobItems=i,t.currentPage=1,q("search"),l.textContent=i.length,S(),I()}catch(e){q("search"),L(e.message)}}})),f.addEventListener("click",(e=>{const o=e.target.closest(".sorting__button");if(!o)return;t.currentPage=1;const s=!!o.className.includes("--recent");s?(h.classList.add("sorting__button--active"),p.classList.remove("sorting__button--active")):(h.classList.remove("sorting__button--active"),p.classList.add("sorting__button--active")),s?t.searchJobItems.sort(((e,t)=>e.daysAgo-t.daysAgo)):t.searchJobItems.sort(((e,t)=>t.relevanceScore-e.relevanceScore)),S(),I()})),o.addEventListener("mouseenter",(()=>{o.classList.add("bookmarks-btn--active"),c.classList.add("job-list--visible"),I("bookmark")})),c.addEventListener("mouseleave",(()=>{o.classList.remove("bookmarks-btn--active"),c.classList.remove("job-list--visible")})),n.addEventListener("click",(e=>{e.target.className.includes("bookmark")&&(document.querySelector(".job-info__bookmark-icon").classList.toggle("job-info__bookmark-icon--bookmarked"),t.bookmarkedJobItems.some((e=>e.id===t.activeJobItem.id))?t.bookmarkedJobItems=t.bookmarkedJobItems.filter((e=>e.id!==t.activeJobItem.id)):t.bookmarkedJobItems.push(t.activeJobItem),I("search"))}))})();